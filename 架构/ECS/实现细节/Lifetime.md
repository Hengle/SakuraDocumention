---
create: 2023-04-23 21:40
aliases: []
tags: [ECS]
---
# 问题描述
需要有能力监控数据的生命周期

- 构造
- 移动
- 拷贝
- 析构
# 方案解析
## Initializer
将需要监控的数据类型分为两个部分：

- initializer - I
- object - O

则可以构建以下行为：

1. 当存在 I 且不存在 O 的时候，我们使用 I 初始化 O；
2. 当拷贝的时候，只有 I 会被拷贝，从而触发 1 逻辑；
3. 当删除 Entity 的时候，O 不会被删除，等待我们手动删除 O；

此方案拥有特点:

- I 的数据只被使用一次用于初始化 O，之后便作为类似于 Flag 的形式存在（当不存在拷贝的时候），造成消耗。
- 只支持了构造和析构生命周期，特性不完全。
- O 的构造被延迟
- 缓存更友好，但将付出一次额外的搬运代价（构造和析构各一次）
## Callback

- 回调就完事了！奥里给！干了兄弟们！
- 性能去他妈！
## Version/DirtyMask
如果不需要区分构造和修改，则使用 version 也可以达成类似的效果。
## MessageQueue
使用一个列表记录所有的修改

- 一般来说不如 Callback 直接
- 逻辑带有影响同步的副作用的时候采用
- 可以在上层实现
